<!DOCTYPE html>
<html lang="ja-JP">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Language" content="ja-JP">
  <link rel="stylesheet" type="text/css" href="../style.css">
  <link rel="icon" type="image/png" href="../rurema.png">
  
  <title>module DL (Ruby 1.8.7)</title>
</head>
<body>

<p>
<a href="../doc/index.html">Ruby 1.8.7 リファレンスマニュアル</a>
&gt; <a href="../library/index.html">ライブラリ一覧</a>
&gt; <a href="../library/dl.html">dlライブラリ</a>
&gt; DLモジュール
</p>


<h1>module DL</h1>
<p>


クラスの継承リスト: DL







</p>

<h2>要約</h2>
<p>
UNIX の <a class="external" href="http://www.opengroup.org/onlinepubs/009695399/functions/dlopen.html">dlopen(3)</a> や Windows の LoadLibrary() などのダイナミックリンカへの低レベルな
インターフェースを提供するモジュールです。
</p>
<p>
モジュール DL は 3 つのクラスから成っています。
</p>
<dl>
<dt><a href="../class/-d-l=3a=3a-symbol.html">DL::Symbol</a></dt>
<dd>
<p>
ダイナミックライブラリの関数のラッパークラスです。
</p>
</dd>
<dt><a href="../class/-d-l=3a=3a-ptr-data.html">DL::PtrData</a></dt>
<dd>
<p>
C のポインタのようなメモリブロックを表すクラスです。
</p>
</dd>
<dt><a href="../class/-d-l=3a=3a-handle.html">DL::Handle</a></dt>
<dd>
<p>
オープンされたダイナミックライブラリを表すクラスです。
</p>
</dd>
</dl>
<h2 >Type specifiers</h2>
<p>
プロトタイプは以下の型修飾子から成ります。プロトタイプの最初の要素は戻り値
の型を意味します。残りの要素は各引数の型を意味します。
</p>
<dl>
<dt>C</dt>
<dd>
<p>
文字 (char)
</p>
</dd>
<dt>c</dt>
<dd>
<p>
文字を指すポインタ (char *)
</p>
</dd>
<dt>H</dt>
<dd>
<p>
short 整数  (short)
</p>
</dd>
<dt>h</dt>
<dd>
<p>
short 整数を指すポインタ (short *)
</p>
</dd>
<dt>I</dt>
<dd>
<p>
整数 (char, short, int)
</p>
</dd>
<dt>i</dt>
<dd>
<p>
整数を指すポインタ (char *, short *, int *)
</p>
</dd>
<dt>L</dt>
<dd>
<p>
long int
</p>
</dd>
<dt>l</dt>
<dd>
<p>
long int へのポインタ (long *)
</p>
</dd>
<dt>F</dt>
<dd>
<p>
実数 (float)
</p>
</dd>
<dt>f</dt>
<dd>
<p>
実数へのポインタ (float *)
</p>
</dd>
<dt>D</dt>
<dd>
<p>
実数 (double)
</p>
</dd>
<dt>d</dt>
<dd>
<p>
実数へのポインタ(double *)
</p>
</dd>
<dt>S</dt>
<dd>
<p>
不変 (immutable) の文字列 (const char *)
</p>
</dd>
<dt>s</dt>
<dd>
<p>
変更可能(mutable)な文字列 (char *)
</p>
</dd>
<dt>A</dt>
<dd>
<p>
配列 (const type[])
</p>
</dd>
<dt>a</dt>
<dd>
<p>
変更可能 (mutable) な配列 (type[])
</p>
</dd>
<dt>P</dt>
<dd>
<p>
ポインタ (void *)
</p>
</dd>
<dt>p</dt>
<dd>
<p>
変更可能 (mutable) なポインタ (void *)
</p>
</dd>
<dt>0</dt>
<dd>
<p>
void 関数 (これはプロトタイプの最初の文字でなければならない)
</p>
</dd>
</dl>
<p>
cbtype は型修飾子 0, C, I, H, L, F, D, S そして P から成ります。
例えば,
</p>
<pre>
DL.callback('IPP'){|ptr1,ptr2|
  str1 = ptr1.ptr.to_s
  str2 = ptr2.ptr.to_s
  str1 &lt;=&gt; str2
}
</pre>
<h2 >Ruby のオブジェクトから C の型への変換</h2>
<p>
<a href="../method/-d-l/m/callback.html">DL.#callback</a> や <a href="../method/-d-l=3a=3a-handle/i/sym.html">DL::Handle#sym</a> で指定した
型指定子に従って Ruby のオブジェクトと C の型は相互に変換されます。
</p>



<h2>目次</h2>
<dl>

<dt>特異メソッド</dt>
<dd>

<a href="#S_LAST_ERROR">last_error</a>

<a href="#S_LAST_ERROR">last_error=</a>

<a href="#S_WIN32_LAST_ERROR">win32_last_error</a>

<a href="#S_WIN32_LAST_ERROR">win32_last_error=</a>

</dd>

<dt>モジュール関数</dt>
<dd>

<a href="#M_CALLBACK">callback</a>

<a href="#M_CALLBACK">define_callback</a>

<a href="#M_DLOPEN">dlopen</a>

<a href="#M_MALLOC">malloc</a>

<a href="#M_REMOVE_CALLBACK">remove_callback</a>

<a href="#M_SIZEOF">sizeof</a>

<a href="#M_STRDUP">strdup</a>

</dd>

<dt>定数</dt>
<dd>

<a href="#C_-A-L-I-G-N_-D-O-U-B-L-E">ALIGN_DOUBLE</a>

<a href="#C_-A-L-I-G-N_-F-L-O-A-T">ALIGN_FLOAT</a>

<a href="#C_-A-L-I-G-N_-I-N-T">ALIGN_INT</a>

<a href="#C_-A-L-I-G-N_-L-O-N-G">ALIGN_LONG</a>

<a href="#C_-A-L-I-G-N_-S-H-O-R-T">ALIGN_SHORT</a>

<a href="#C_-A-L-I-G-N_-V-O-I-D-P">ALIGN_VOIDP</a>

<a href="#C_-D-L-S-T-A-C-K">DLSTACK</a>

<a href="#C_-F-R-E-E">FREE</a>

<a href="#C_-FUNC-TABLE">FuncTable</a>

<a href="#C_-M-A-X_-A-R-G">MAX_ARG</a>

<a href="#C_-R-T-L-D_-G-L-O-B-A-L">RTLD_GLOBAL</a>

<a href="#C_-R-T-L-D_-L-A-Z-Y">RTLD_LAZY</a>

<a href="#C_-R-T-L-D_-N-O-W">RTLD_NOW</a>

</dd>

</dl>


<h2>特異メソッド</h2>
<dl>

<dt class="method-heading" id="S_LAST_ERROR"><code>last_error</code><span class="permalink">[<a href="../method/-d-l/s/last_error.html">permalink</a>][<a href="http://docs.ruby-lang.org/en/1.8.7/DL.html#method-c-last_error">rdoc</a>]</span></dt>
<dt class="method-heading"><code>last_error=</code></dt>
<dd class="method-description">
<p class="todo">
[TODO]
</p>
</dd>


<dt class="method-heading" id="S_WIN32_LAST_ERROR"><code>win32_last_error</code><span class="permalink">[<a href="../method/-d-l/s/win32_last_error.html">permalink</a>][<a href="http://docs.ruby-lang.org/en/1.8.7/DL.html#method-c-win32_last_error">rdoc</a>]</span></dt>
<dt class="method-heading"><code>win32_last_error=</code></dt>
<dd class="method-description">
<p class="todo">
[TODO]
</p>
</dd>


</dl>

<h2>モジュール関数</h2>
<dl>

<dt class="method-heading" id="M_CALLBACK"><code>callback(type) -&gt; DL::Symbol</code><span class="permalink">[<a href="../method/-d-l/m/callback.html">permalink</a>][<a href="http://docs.ruby-lang.org/en/1.8.7/DL.html#method-c-callback">rdoc</a>]</span></dt>
<dt class="method-heading"><code>define_callback(type) -&gt; DL::Symbol</code></dt>
<dd class="method-description">
<p class="todo">
[TODO]
</p>
<p>
Cレベルのコールバック関数を定義し、その関数(へのポインタ)を保持した
<a href="../class/-d-l=3a=3a-symbol.html">DL::Symbol</a> を返します。
</p>
<dl>
<dt class='method-param'>[PARAM] type:</dt>
<dd>
コールバック関数の型指定子を与えます。
</dd>
<dt>[EXCEPTION] DL::DLError:</dt>
<dd>
定義できるコールバック関数の数には制限があります。それを越えると、DL::DLError が発生します。
</dd>
</dl>
<pre>
require 'dl/import'
strlast = DL.callback('IS'){|s|
  s[-1]
}

module M
  extend DL::Importable
  dlload &quot;./libtest.so&quot;
  extern &quot;int call(void *, const char*)&quot;
end
p LIBC.call(strlast, &quot;abcd&quot;).chr #=&gt; &quot;d&quot;
</pre>
<pre>
 /* libtest.so */
 int call(int (*cb)(const char*), const char* s){
   return (*cb)(s);
 }
</pre>
</dd>


<dt class="method-heading" id="M_DLOPEN"><code>dlopen(lib) -&gt; DL::Handle</code><span class="permalink">[<a href="../method/-d-l/m/dlopen.html">permalink</a>][<a href="http://docs.ruby-lang.org/en/1.8.7/DL.html#method-c-dlopen">rdoc</a>]</span></dt>
<dt class="method-heading"><code>dlopen(lib) {|handle| ... } -&gt; DL::Handle</code></dt>
<dd class="method-description">
<p>
ダイナミックライブラリ lib をロードし、
<a href="../class/-d-l=3a=3a-handle.html">DL::Handle</a> として返します。
</p>
<p>
ブロックが与えられている場合は、<a href="../class/-d-l=3a=3a-handle.html">DL::Handle</a> 引数として
与えられたブロックを実行します。<a href="../class/-d-l=3a=3a-handle.html">DL::Handle</a> を返します。
</p>
<p>
<a href="../method/-d-l=3a=3a-handle/s/new.html">DL::Handle.new</a>(lib) と等価です。
</p>
<dl>
<dt class='method-param'>[PARAM] lib:</dt>
<dd>
ロードしたいライブラリを文字列で与えます。
</dd>
<dt>[EXCEPTION] RuntimeError:</dt>
<dd>
<a class="external" href="http://www.opengroup.org/onlinepubs/009695399/functions/dlopen.html">dlopen(3)</a> に失敗した時に発生します。
</dd>
</dl>
</dd>


<dt class="method-heading" id="M_MALLOC"><code>malloc(size) -&gt; DL::PtrData</code><span class="permalink">[<a href="../method/-d-l/m/malloc.html">permalink</a>][<a href="http://docs.ruby-lang.org/en/1.8.7/DL.html#method-c-malloc">rdoc</a>]</span></dt>
<dd class="method-description">
<p>
size バイトのメモリ領域を確保し、
その領域を指す <a href="../class/-d-l=3a=3a-ptr-data.html">DL::PtrData</a> オブジェクトを返します。
</p>
<p>
この返り値には、<a href="../method/-d-l/c/-f-r-e-e.html">DL::FREE</a> が free 関数としてセットされています。
</p>
<dl>
<dt class='method-param'>[PARAM] size:</dt>
<dd>
必要なメモリ領域のサイズを指定します。
</dd>
</dl>
</dd>


<dt class="method-heading" id="M_REMOVE_CALLBACK"><code>remove_callback(sym) -&gt; nil</code><span class="permalink">[<a href="../method/-d-l/m/remove_callback.html">permalink</a>][<a href="http://docs.ruby-lang.org/en/1.8.7/DL.html#method-c-remove_callback">rdoc</a>]</span></dt>
<dd class="method-description">
<p>
コールバック関数 sym を <a href="../method/-d-l/c/-func-table.html">DL::FuncTable</a> から削除します。
以後 sym.call を呼ぶことができなくなります。
</p>
<dl>
<dt class='method-param'>[PARAM] sym:</dt>
<dd>
テーブルから削除したい <a href="../class/-d-l=3a=3a-symbol.html">DL::Symbol</a> オブジェクトを与えます。
</dd>
</dl>
</dd>


<dt class="method-heading" id="M_SIZEOF"><code>sizeof(type) -&gt; Integer</code><span class="permalink">[<a href="../method/-d-l/m/sizeof.html">permalink</a>][<a href="http://docs.ruby-lang.org/en/1.8.7/DL.html#method-c-sizeof">rdoc</a>]</span></dt>
<dd class="method-description">
<p>
型のサイズを返します。
</p>
<p>
sizeof(&quot;C&quot;) + sizeof(&quot;L&quot;) は、sizeof(&quot;CL&quot;) と等価ではありません。
後者は構造体 struct foo { char c; long l; } の
十分なサイズを返すと推定されますが、
そのサイズは C の sizeof(foo) と同じではないかもしれません。
つまり、sizeof メソッドは独自にアラインメントを考慮してサイズを決定
しますが、 C 言語のそれとは異なるかもしれません。
</p>
<p>
sizeof(&quot;L3&quot;) のように型の後に数字を付けることもできます。
指定できる型については <a href="../class/-d-l.html">DL</a> を参照してください。
</p>
<dl>
<dt class='method-param'>[PARAM] type:</dt>
<dd>
型指定子を文字列で与えます。
</dd>
<dt>[EXCEPTION] DL::DLTypeError:</dt>
<dd>
定められた文字以外を型指定子として与えると発生します。
</dd>
</dl>
</dd>


<dt class="method-heading" id="M_STRDUP"><code>strdup(str) -&gt; DL::PtrData</code><span class="permalink">[<a href="../method/-d-l/m/strdup.html">permalink</a>][<a href="http://docs.ruby-lang.org/en/1.8.7/DL.html#method-c-strdup">rdoc</a>]</span></dt>
<dd class="method-description">
<p>
文字列 str を複製し、その新しい文字列へのポインタ
<a href="../class/-d-l=3a=3a-ptr-data.html">DL::PtrData</a> オブジェクトを返します。
</p>
<p>
この返り値には、<a href="../method/-d-l/c/-f-r-e-e.html">DL::FREE</a> が free 関数としてセットされています。
</p>
<dl>
<dt class='method-param'>[PARAM] str:</dt>
<dd>
文字列を与えます。
</dd>
</dl>
</dd>


</dl>

<h2>定数</h2>
<dl>

<dt class="method-heading" id="C_-A-L-I-G-N_-D-O-U-B-L-E"><code>ALIGN_DOUBLE</code><span class="permalink">[<a href="../method/-d-l/c/-a-l-i-g-n_-d-o-u-b-l-e.html">permalink</a>][<a href="http://docs.ruby-lang.org/en/1.8.7/DL.html#method-c-ALIGN_DOUBLE">rdoc</a>]</span></dt>
<dd class="method-description">
<p class="todo">
[TODO]
</p>
</dd>


<dt class="method-heading" id="C_-A-L-I-G-N_-F-L-O-A-T"><code>ALIGN_FLOAT</code><span class="permalink">[<a href="../method/-d-l/c/-a-l-i-g-n_-f-l-o-a-t.html">permalink</a>][<a href="http://docs.ruby-lang.org/en/1.8.7/DL.html#method-c-ALIGN_FLOAT">rdoc</a>]</span></dt>
<dd class="method-description">
<p class="todo">
[TODO]
</p>
</dd>


<dt class="method-heading" id="C_-A-L-I-G-N_-I-N-T"><code>ALIGN_INT</code><span class="permalink">[<a href="../method/-d-l/c/-a-l-i-g-n_-i-n-t.html">permalink</a>][<a href="http://docs.ruby-lang.org/en/1.8.7/DL.html#method-c-ALIGN_INT">rdoc</a>]</span></dt>
<dd class="method-description">
<p class="todo">
[TODO]
</p>
</dd>


<dt class="method-heading" id="C_-A-L-I-G-N_-L-O-N-G"><code>ALIGN_LONG</code><span class="permalink">[<a href="../method/-d-l/c/-a-l-i-g-n_-l-o-n-g.html">permalink</a>][<a href="http://docs.ruby-lang.org/en/1.8.7/DL.html#method-c-ALIGN_LONG">rdoc</a>]</span></dt>
<dd class="method-description">
<p class="todo">
[TODO]
</p>
</dd>


<dt class="method-heading" id="C_-A-L-I-G-N_-S-H-O-R-T"><code>ALIGN_SHORT</code><span class="permalink">[<a href="../method/-d-l/c/-a-l-i-g-n_-s-h-o-r-t.html">permalink</a>][<a href="http://docs.ruby-lang.org/en/1.8.7/DL.html#method-c-ALIGN_SHORT">rdoc</a>]</span></dt>
<dd class="method-description">
<p class="todo">
[TODO]
</p>
</dd>


<dt class="method-heading" id="C_-A-L-I-G-N_-V-O-I-D-P"><code>ALIGN_VOIDP</code><span class="permalink">[<a href="../method/-d-l/c/-a-l-i-g-n_-v-o-i-d-p.html">permalink</a>][<a href="http://docs.ruby-lang.org/en/1.8.7/DL.html#method-c-ALIGN_VOIDP">rdoc</a>]</span></dt>
<dd class="method-description">
<p class="todo">
[TODO]
</p>
</dd>


<dt class="method-heading" id="C_-D-L-S-T-A-C-K"><code>DLSTACK</code><span class="permalink">[<a href="../method/-d-l/c/-d-l-s-t-a-c-k.html">permalink</a>][<a href="http://docs.ruby-lang.org/en/1.8.7/DL.html#method-c-DLSTACK">rdoc</a>]</span></dt>
<dd class="method-description">
<p class="todo">
[TODO]
</p>
</dd>


<dt class="method-heading" id="C_-F-R-E-E"><code>FREE</code><span class="permalink">[<a href="../method/-d-l/c/-f-r-e-e.html">permalink</a>][<a href="http://docs.ruby-lang.org/en/1.8.7/DL.html#method-c-FREE">rdoc</a>]</span></dt>
<dd class="method-description">
<p class="todo">
[TODO]
</p>
<p>
<a class="external" href="http://www.opengroup.org/onlinepubs/009695399/functions/free.html">free(3)</a> を表す <a href="../class/-d-l=3a=3a-symbol.html">DL::Symbol</a> です。
この定数に新たに DL::Symbol を代入しても、DL::PtrData にデフォルトでセットされる
free 関数が変わることはありません。
</p>
</dd>


<dt class="method-heading" id="C_-FUNC-TABLE"><code>FuncTable</code><span class="permalink">[<a href="../method/-d-l/c/-func-table.html">permalink</a>][<a href="http://docs.ruby-lang.org/en/1.8.7/DL.html#method-c-FuncTable">rdoc</a>]</span></dt>
<dd class="method-description">
<p class="todo">
[TODO]
</p>
</dd>


<dt class="method-heading" id="C_-M-A-X_-A-R-G"><code>MAX_ARG</code><span class="permalink">[<a href="../method/-d-l/c/-m-a-x_-a-r-g.html">permalink</a>][<a href="http://docs.ruby-lang.org/en/1.8.7/DL.html#method-c-MAX_ARG">rdoc</a>]</span></dt>
<dd class="method-description">
<p class="todo">
[TODO]
</p>
</dd>


<dt class="method-heading" id="C_-R-T-L-D_-G-L-O-B-A-L"><code>RTLD_GLOBAL</code><span class="permalink">[<a href="../method/-d-l/c/-r-t-l-d_-g-l-o-b-a-l.html">permalink</a>][<a href="http://docs.ruby-lang.org/en/1.8.7/DL.html#method-c-RTLD_GLOBAL">rdoc</a>]</span></dt>
<dd class="method-description">
<p class="todo">
[TODO]
</p>
</dd>


<dt class="method-heading" id="C_-R-T-L-D_-L-A-Z-Y"><code>RTLD_LAZY</code><span class="permalink">[<a href="../method/-d-l/c/-r-t-l-d_-l-a-z-y.html">permalink</a>][<a href="http://docs.ruby-lang.org/en/1.8.7/DL.html#method-c-RTLD_LAZY">rdoc</a>]</span></dt>
<dd class="method-description">
<p class="todo">
[TODO]
</p>
</dd>


<dt class="method-heading" id="C_-R-T-L-D_-N-O-W"><code>RTLD_NOW</code><span class="permalink">[<a href="../method/-d-l/c/-r-t-l-d_-n-o-w.html">permalink</a>][<a href="http://docs.ruby-lang.org/en/1.8.7/DL.html#method-c-RTLD_NOW">rdoc</a>]</span></dt>
<dd class="method-description">
<p class="todo">
[TODO]
</p>
</dd>


</dl>



<div id="footer">
  <a rel="license" href="https://creativecommons.org/licenses/by/3.0/">
    <img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/3.0/88x31.png" />
  </a>
</div>
</body>
</html>
