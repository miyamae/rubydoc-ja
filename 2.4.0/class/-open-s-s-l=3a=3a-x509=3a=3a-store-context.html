<!DOCTYPE html>
<html lang="ja-JP">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Language" content="ja-JP">
  <link rel="stylesheet" type="text/css" href="../style.css">
  <link rel="icon" type="image/png" href="../rurema.png">
  
  <title>class OpenSSL::X509::StoreContext (Ruby 2.4.0)</title>
</head>
<body>

<p>
<a href="../doc/index.html">Ruby 2.4.0 リファレンスマニュアル</a>
&gt; <a href="../library/index.html">ライブラリ一覧</a>
&gt; <a href="../library/openssl.html">opensslライブラリ</a>
&gt; OpenSSL::X509::StoreContextクラス
</p>


<h1>class OpenSSL::X509::StoreContext</h1>
<p>


クラスの継承リスト: OpenSSL::X509::StoreContext

      &lt; <a href="../class/-object.html">Object</a>
      

      &lt; <a href="../class/-kernel.html">Kernel</a>
      

      &lt; <a href="../class/-basic-object.html">BasicObject</a>
      







</p>

<h2>要約</h2>
<p>
証明書ストアコンテキストクラス。
</p>
<p>
証明書ストア(<a href="../class/-open-s-s-l=3a=3a-x509=3a=3a-store.html">OpenSSL::X509::Store</a>)を利用して
実際の検証を行う機能を持ちます。
</p>
<p>
また、検証の途中の状態を保持するためにも使われます。
検証フィルター(<a href="../method/-open-s-s-l=3a=3a-x509=3a=3a-store/i/verify_proc.html">OpenSSL::X509::Store#verify_proc</a>)の
引数として渡されます。
</p>
<p>
検証結果の詳細情報を保持するためにも使われます。
</p>



<h2>目次</h2>
<dl>

<dt>特異メソッド</dt>
<dd>

<a href="#S_NEW">new</a>

</dd>

<dt>インスタンスメソッド</dt>
<dd>

<a href="#I_CHAIN">chain</a>

<a href="#I_CLEANUP">cleanup</a>

<a href="#I_CURRENT_CERT">current_cert</a>

<a href="#I_CURRENT_CRL">current_crl</a>

<a href="#I_ERROR">error</a>

<a href="#I_ERROR--3D">error=</a>

<a href="#I_ERROR_DEPTH">error_depth</a>

<a href="#I_ERROR_STRING">error_string</a>

<a href="#I_FLAGS--3D">flags=</a>

<a href="#I_PURPOSE--3D">purpose=</a>

<a href="#I_TIME--3D">time=</a>

<a href="#I_TRUST--3D">trust=</a>

<a href="#I_VERIFY">verify</a>

</dd>

</dl>


<h2>特異メソッド</h2>
<dl>

<dt class="method-heading" id="S_NEW"><code>new(store, cert, chain=nil) -&gt; OpenSSL::X509::StoreContext</code><span class="permalink">[<a href="../method/-open-s-s-l=3a=3a-x509=3a=3a-store-context/s/new.html">permalink</a>][<a href="http://docs.ruby-lang.org/en/2.4.0/OpenSSL/X509/StoreContext.html#method-c-new">rdoc</a>]</span></dt>
<dd class="method-description">
<p>
証明書ストアコンテキストを生成します。
</p>
<p>
store には検証に必要なルート CA 証明書を含む <a href="../class/-open-s-s-l=3a=3a-x509=3a=3a-store.html">OpenSSL::X509::Store</a>
オブジェクトを渡します。 cert は検証対象の証明書、chain は
中間 CA 証明書チェインを証明書の配列で渡します。
</p>
<dl>
<dt class='method-param'>[PARAM] store:</dt>
<dd>
ルート CA 群を持っている証明書ストア
(<a href="../class/-open-s-s-l=3a=3a-x509=3a=3a-store.html">OpenSSL::X509::Store</a> オブジェクト)
</dd>
<dt class='method-param'>[PARAM] cert:</dt>
<dd>
検証対象となる証明書(<a href="../class/-open-s-s-l=3a=3a-x509=3a=3a-certificate.html">OpenSSL::X509::Certificate</a> オブジェクト)
</dd>
<dt class='method-param'>[PARAM] chain:</dt>
<dd>
検証に利用する証明書チェイン
(<a href="../class/-open-s-s-l=3a=3a-x509=3a=3a-certificate.html">OpenSSL::X509::Certificate</a> オブジェクトの配列)
</dd>
<dt>[EXCEPTION] OpenSSL::X509::StoreError:</dt>
<dd>
コンテキストの生成に失敗した場合に発生します
</dd>
</dl>
</dd>


</dl>

<h2>インスタンスメソッド</h2>
<dl>

<dt class="method-heading" id="I_CHAIN"><code>chain -&gt; [OpenSSL::X509::Certificate] | nil</code><span class="permalink">[<a href="../method/-open-s-s-l=3a=3a-x509=3a=3a-store-context/i/chain.html">permalink</a>][<a href="http://docs.ruby-lang.org/en/2.4.0/OpenSSL/X509/StoreContext.html#method-i-chain">rdoc</a>]</span></dt>
<dd class="method-description">
<p>
検証に利用した証明書チェインを証明書オブジェクト
(<a href="../class/-open-s-s-l=3a=3a-x509=3a=3a-certificate.html">OpenSSL::X509::Certificate</a>のインスタンス)の配列で返します。
</p>
<p>
<a href="../method/-open-s-s-l=3a=3a-x509=3a=3a-store-context/i/verify.html">OpenSSL::X509::StoreContext#verify</a> を呼ぶ前は nil を返します。
</p>
</dd>


<dt class="method-heading" id="I_CLEANUP"><code>cleanup -&gt; self</code><span class="permalink">[<a href="../method/-open-s-s-l=3a=3a-x509=3a=3a-store-context/i/cleanup.html">permalink</a>][<a href="http://docs.ruby-lang.org/en/2.4.0/OpenSSL/X509/StoreContext.html#method-i-cleanup">rdoc</a>]</span></dt>
<dd class="method-description">
<p>
このメソッドは使わないでください。
</p>
</dd>


<dt class="method-heading" id="I_CURRENT_CERT"><code>current_cert -&gt; OpenSSL::X509::Certificate</code><span class="permalink">[<a href="../method/-open-s-s-l=3a=3a-x509=3a=3a-store-context/i/current_cert.html">permalink</a>][<a href="http://docs.ruby-lang.org/en/2.4.0/OpenSSL/X509/StoreContext.html#method-i-current_cert">rdoc</a>]</span></dt>
<dd class="method-description">
<p>
直前に検証した証明書のオブジェクトを返します。
</p>
<p>
<a href="../method/-open-s-s-l=3a=3a-x509=3a=3a-store-context/i/verify.html">OpenSSL::X509::StoreContext#verify</a> で検証が失敗した場合は
証明書チェイン中で検証に失敗した証明書のオブジェクトを返します。
</p>
<p>
証明書チェインの各証明書検証後
コールバック(<a href="../method/-open-s-s-l=3a=3a-x509=3a=3a-store/i/verify_callback=3d.html">OpenSSL::X509::Store#verify_callback=</a>)呼び出しに
渡される StoreContext オブジェクトにこのメソッドを呼び出すと
直前に検証した証明書を返します。
</p>
<p>
<a href="../method/-open-s-s-l=3a=3a-x509=3a=3a-store-context/i/verify.html">OpenSSL::X509::StoreContext#verify</a> を呼ぶ前に
このメソッドを呼ぶと空の <a href="../class/-open-s-s-l=3a=3a-x509=3a=3a-certificate.html">OpenSSL::X509::Certificate</a> を返します。
</p>
</dd>


<dt class="method-heading" id="I_CURRENT_CRL"><code>current_crl -&gt; OpenSSL::X509::CRL | nil</code><span class="permalink">[<a href="../method/-open-s-s-l=3a=3a-x509=3a=3a-store-context/i/current_crl.html">permalink</a>][<a href="http://docs.ruby-lang.org/en/2.4.0/OpenSSL/X509/StoreContext.html#method-i-current_crl">rdoc</a>]</span></dt>
<dd class="method-description">
<p>
直前に検証に利用した CRL のオブジェクトを返します。
</p>
<p>
証明書チェインの各証明書検証後
コールバック(<a href="../method/-open-s-s-l=3a=3a-x509=3a=3a-store/i/verify_callback=3d.html">OpenSSL::X509::Store#verify_callback=</a>)呼び出しに
渡される StoreContext オブジェクトにこのメソッドを呼び出すと
直前に検証に利用した CRL オブジェクトを返します。
</p>
</dd>


<dt class="method-heading" id="I_ERROR"><code>error -&gt; Integer</code><span class="permalink">[<a href="../method/-open-s-s-l=3a=3a-x509=3a=3a-store-context/i/error.html">permalink</a>][<a href="http://docs.ruby-lang.org/en/2.4.0/OpenSSL/X509/StoreContext.html#method-i-error">rdoc</a>]</span></dt>
<dd class="method-description">
<p>
検証時のエラーコードを返します。
</p>
<p>
<a href="../method/-open-s-s-l=3a=3a-x509=3a=3a-store-context/i/verify.html">OpenSSL::X509::StoreContext#verify</a> を呼びだし、
証明書チェインの各証明書を検証した
コールバック(<a href="../method/-open-s-s-l=3a=3a-x509=3a=3a-store/i/verify_callback=3d.html">OpenSSL::X509::Store#verify_callback=</a>)が呼び出され、
StoreContext オブジェクトが渡されますが、このメソッドを呼ぶと
直前の証明書検証結果のエラーコードが得られます。
</p>
<p>
<a href="../method/-open-s-s-l=3a=3a-x509=3a=3a-store-context/i/verify.html">OpenSSL::X509::StoreContext#verify</a> を呼び出したあと、
このメソッドを呼ぶと検証の最終的な検証結果のエラーコードを返します。
</p>
<p>
エラーコードの整数値は <a href="../class/-open-s-s-l=3a=3a-x509.html">OpenSSL::X509</a> に定数が定義されています。
詳しくは <a href="../class/-open-s-s-l=3a=3a-x509.html#verify_error">OpenSSL::X509/検証時エラー定数</a> を見てください。
検証に成功した場合は <a href="../method/-open-s-s-l=3a=3a-x509/c/-v_-o-k.html">OpenSSL::X509::V_OK</a> を返します。
</p>
<p>
[SEE_ALSO] <a href="../method/-open-s-s-l=3a=3a-x509=3a=3a-store/i/error.html">OpenSSL::X509::Store#error</a>
</p>
</dd>


<dt class="method-heading" id="I_ERROR--3D"><code>error=(error)</code><span class="permalink">[<a href="../method/-open-s-s-l=3a=3a-x509=3a=3a-store-context/i/error=3d.html">permalink</a>][<a href="http://docs.ruby-lang.org/en/2.4.0/OpenSSL/X509/StoreContext.html#method-i-error-3D">rdoc</a>]</span></dt>
<dd class="method-description">
<p>
エラーコードを設定します。
</p>
<p>
<a href="../method/-open-s-s-l=3a=3a-x509=3a=3a-store-context/i/verify.html">OpenSSL::X509::StoreContext#verify</a> を呼びだし、
証明書チェインの各証明書を検証した
コールバック(<a href="../method/-open-s-s-l=3a=3a-x509=3a=3a-store/i/verify_callback=3d.html">OpenSSL::X509::Store#verify_callback=</a>)が呼び出され、
StoreContext オブジェクトが渡されますが、このメソッドでエラーコードを
設定し、コールバックの返り値を false にすると、最終的なエラーコードが
ここで設定したものになります。<a href="../method/-open-s-s-l=3a=3a-x509=3a=3a-store-context/i/error_string.html">OpenSSL::X509::StoreContext#error_string</a>
もその値に応じた文字列が返るようになります。
</p>
<p>
例:
</p>
<pre>
store = OpenSSL::X509::Store.new
store.set_default_paths
cert = OpenSSL::X509::Certificate.new(...)
store.verify(cert, chain){|ok,ctx|
  ctx.error = OpenSSL::X509::V_ERR_APPLICATION_VERIFICATION;
false}  # =&gt; false
p store.error # =&gt; OpenSSL::X509::V_ERR_APPLICATION_VERIFICATION
p store.error_string # =&gt; &quot;application verification failure&quot;
</pre>
<dl>
<dt class='method-param'>[PARAM] error:</dt>
<dd>
エラーコードの整数値
</dd>
</dl>
<p>
[SEE_ALSO] <a href="../method/-open-s-s-l=3a=3a-x509=3a=3a-store-context/i/error.html">OpenSSL::X509::StoreContext#error</a>
</p>
</dd>


<dt class="method-heading" id="I_ERROR_DEPTH"><code>error_depth -&gt; Integer</code><span class="permalink">[<a href="../method/-open-s-s-l=3a=3a-x509=3a=3a-store-context/i/error_depth.html">permalink</a>][<a href="http://docs.ruby-lang.org/en/2.4.0/OpenSSL/X509/StoreContext.html#method-i-error_depth">rdoc</a>]</span></dt>
<dd class="method-description">
<p>
エラーが起きた場所の深さを返します。
</p>
<p>
検証対象の証明書は深さ0、その証明書を発行した CA の証明書は
深さ1、その CA の証明証を発行した上位の CA の証明書は深さ2、…
と定義されいてます。
</p>
<p>
<a href="../method/-open-s-s-l=3a=3a-x509=3a=3a-store-context/i/verify.html">OpenSSL::X509::StoreContext#verify</a> を呼び出したあと、
このメソッドを呼ぶと検証でエラーが起きた場所の深さを返します。
</p>
<p>
証明書チェインの各証明書を検証した
コールバック(<a href="../method/-open-s-s-l=3a=3a-x509=3a=3a-store/i/verify_callback=3d.html">OpenSSL::X509::Store#verify_callback=</a>)が検証時に
呼びだされ、StoreContext オブジェクトが渡されますが、そのオブジェクトに
対しこのメソッドを呼びだすと、そこで検証された証明書の
深さが得られます。
</p>
</dd>


<dt class="method-heading" id="I_ERROR_STRING"><code>error_string -&gt; String</code><span class="permalink">[<a href="../method/-open-s-s-l=3a=3a-x509=3a=3a-store-context/i/error_string.html">permalink</a>][<a href="http://docs.ruby-lang.org/en/2.4.0/OpenSSL/X509/StoreContext.html#method-i-error_string">rdoc</a>]</span></dt>
<dd class="method-description">
<p>
検証したときのエラー文字列を返します。
</p>
<p>
<a href="../method/-open-s-s-l=3a=3a-x509=3a=3a-store-context/i/verify.html">OpenSSL::X509::StoreContext#verify</a> を呼びだし、
証明書チェインの各証明書を検証した
コールバック(<a href="../method/-open-s-s-l=3a=3a-x509=3a=3a-store/i/verify_callback=3d.html">OpenSSL::X509::Store#verify_callback=</a>)が呼び出され、
StoreContext オブジェクトが渡されますが、このメソッドを呼ぶと
直前の証明書検証結果のエラー文字列が得られます。
</p>
<p>
<a href="../method/-open-s-s-l=3a=3a-x509=3a=3a-store-context/i/verify.html">OpenSSL::X509::StoreContext#verify</a> を呼び出したあと、
このメソッドを呼ぶと検証の最終的な検証結果のエラー文字列を返します。
</p>
<p>
検証に成功した場合は &quot;ok&quot; を返します。
</p>
</dd>


<dt class="method-heading" id="I_FLAGS--3D"><code>flags=(flags)</code><span class="permalink">[<a href="../method/-open-s-s-l=3a=3a-x509=3a=3a-store-context/i/flags=3d.html">permalink</a>][<a href="http://docs.ruby-lang.org/en/2.4.0/OpenSSL/X509/StoreContext.html#method-i-flags-3D">rdoc</a>]</span></dt>
<dd class="method-description">
<p>
CRL に関するフラグを設定します。
</p>
<p>
以下の定数から必要なものを選んで OR 取り、渡します。
</p>
<ul>
<li><a href="../method/-open-s-s-l=3a=3a-x509/c/-v_-f-l-a-g_-c-r-l_-c-h-e-c-k.html">OpenSSL::X509::V_FLAG_CRL_CHECK</a></li>
<li><a href="../method/-open-s-s-l=3a=3a-x509/c/-v_-f-l-a-g_-c-r-l_-c-h-e-c-k_-a-l-l.html">OpenSSL::X509::V_FLAG_CRL_CHECK_ALL</a></li>
</ul>
<dl>
<dt class='method-param'>[PARAM] flags:</dt>
<dd>
設定するフラグ(整数値)
</dd>
</dl>
<p>
[SEE_ALSO] <a href="../method/-open-s-s-l=3a=3a-x509=3a=3a-store/i/flags=3d.html">OpenSSL::X509::Store#flags=</a>
</p>
</dd>


<dt class="method-heading" id="I_PURPOSE--3D"><code>purpose=(purpose)</code><span class="permalink">[<a href="../method/-open-s-s-l=3a=3a-x509=3a=3a-store-context/i/purpose=3d.html">permalink</a>][<a href="http://docs.ruby-lang.org/en/2.4.0/OpenSSL/X509/StoreContext.html#method-i-purpose-3D">rdoc</a>]</span></dt>
<dd class="method-description">
<p>
証明書の使用目的を設定します。
</p>
<p>
以下の定数値のうちいずれか1つを渡します。
</p>
<ul>
<li><a href="../method/-open-s-s-l=3a=3a-x509/c/-p-u-r-p-o-s-e_-a-n-y.html">OpenSSL::X509::PURPOSE_ANY</a></li>
<li><a href="../method/-open-s-s-l=3a=3a-x509/c/-p-u-r-p-o-s-e_-c-r-l_-s-i-g-n.html">OpenSSL::X509::PURPOSE_CRL_SIGN</a></li>
<li><a href="../method/-open-s-s-l=3a=3a-x509/c/-p-u-r-p-o-s-e_-n-s_-s-s-l_-s-e-r-v-e-r.html">OpenSSL::X509::PURPOSE_NS_SSL_SERVER</a></li>
<li><a href="../method/-open-s-s-l=3a=3a-x509/c/-p-u-r-p-o-s-e_-s-m-i-m-e_-e-n-c-r-y-p-t.html">OpenSSL::X509::PURPOSE_SMIME_ENCRYPT</a></li>
<li><a href="../method/-open-s-s-l=3a=3a-x509/c/-p-u-r-p-o-s-e_-s-m-i-m-e_-s-i-g-n.html">OpenSSL::X509::PURPOSE_SMIME_SIGN</a></li>
<li><a href="../method/-open-s-s-l=3a=3a-x509/c/-p-u-r-p-o-s-e_-s-s-l_-c-l-i-e-n-t.html">OpenSSL::X509::PURPOSE_SSL_CLIENT</a></li>
<li><a href="../method/-open-s-s-l=3a=3a-x509/c/-p-u-r-p-o-s-e_-s-s-l_-s-e-r-v-e-r.html">OpenSSL::X509::PURPOSE_SSL_SERVER</a></li>
<li><a href="../method/-open-s-s-l=3a=3a-x509/c/-p-u-r-p-o-s-e_-o-s-c-p_-h-e-l-p-e-r.html">OpenSSL::X509::PURPOSE_OSCP_HELPER</a></li>
</ul>
<p>
証明書に記載されている使用目的が適合していない場合には検証が失敗します。
</p>
<dl>
<dt class='method-param'>[PARAM] purpose:</dt>
<dd>
証明書の使用目的を表す整数値
</dd>
</dl>
<p>
[SEE_ALSO] <a href="../method/-open-s-s-l=3a=3a-x509=3a=3a-store/i/purpose=3d.html">OpenSSL::X509::Store#purpose=</a>
</p>
</dd>


<dt class="method-heading" id="I_TIME--3D"><code>time=(time)</code><span class="permalink">[<a href="../method/-open-s-s-l=3a=3a-x509=3a=3a-store-context/i/time=3d.html">permalink</a>][<a href="http://docs.ruby-lang.org/en/2.4.0/OpenSSL/X509/StoreContext.html#method-i-time-3D">rdoc</a>]</span></dt>
<dd class="method-description">
<p>
証明書の有効期限の検証に使う日時を設定します。
</p>
<p>
デフォルトでは現在時刻が使われます。
</p>
<dl>
<dt class='method-param'>[PARAM] time:</dt>
<dd>
検証に使う日時の <a href="../class/-time.html">Time</a> オブジェクト
</dd>
</dl>
<p>
[SEE_ALSO] <a href="../method/-open-s-s-l=3a=3a-x509=3a=3a-store/i/time=3d.html">OpenSSL::X509::Store#time=</a>
</p>
</dd>


<dt class="method-heading" id="I_TRUST--3D"><code>trust=(trust)</code><span class="permalink">[<a href="../method/-open-s-s-l=3a=3a-x509=3a=3a-store-context/i/trust=3d.html">permalink</a>][<a href="http://docs.ruby-lang.org/en/2.4.0/OpenSSL/X509/StoreContext.html#method-i-trust-3D">rdoc</a>]</span></dt>
<dd class="method-description">
<p class="todo">
[TODO]
</p>
<p>
以下のいずれかの定数の値を指定します。
</p>
<ul>
<li><a href="../method/-open-s-s-l=3a=3a-x509/c/-t-r-u-s-t_-c-o-m-p-a-t.html">OpenSSL::X509::TRUST_COMPAT</a></li>
<li><a href="../method/-open-s-s-l=3a=3a-x509/c/-t-r-u-s-t_-e-m-a-i-l.html">OpenSSL::X509::TRUST_EMAIL</a></li>
<li><a href="../method/-open-s-s-l=3a=3a-x509/c/-t-r-u-s-t_-o-b-j-e-c-t_-s-i-g-n.html">OpenSSL::X509::TRUST_OBJECT_SIGN</a></li>
<li><a href="../method/-open-s-s-l=3a=3a-x509/c/-t-r-u-s-t_-s-s-l_-c-l-i-e-n-t.html">OpenSSL::X509::TRUST_SSL_CLIENT</a></li>
<li><a href="../method/-open-s-s-l=3a=3a-x509/c/-t-r-u-s-t_-s-s-l_-s-e-r-v-e-r.html">OpenSSL::X509::TRUST_SSL_SERVER</a></li>
<li><a href="../method/-open-s-s-l=3a=3a-x509/c/-t-r-u-s-t_-o-c-s-p_-r-e-q-u-e-s-t.html">OpenSSL::X509::TRUST_OCSP_REQUEST</a></li>
<li><a href="../method/-open-s-s-l=3a=3a-x509/c/-t-r-u-s-t_-o-c-s-p_-s-i-g-n.html">OpenSSL::X509::TRUST_OCSP_SIGN</a></li>
</ul>
<dl>
<dt class='method-param'>[PARAM] trust:</dt>
<dd>
整数値
</dd>
</dl>
<p>
[SEE_ALSO] <a href="../method/-open-s-s-l=3a=3a-x509=3a=3a-store/i/trust=3d.html">OpenSSL::X509::Store#trust=</a>
</p>
</dd>


<dt class="method-heading" id="I_VERIFY"><code>verify -&gt; bool</code><span class="permalink">[<a href="../method/-open-s-s-l=3a=3a-x509=3a=3a-store-context/i/verify.html">permalink</a>][<a href="http://docs.ruby-lang.org/en/2.4.0/OpenSSL/X509/StoreContext.html#method-i-verify">rdoc</a>]</span></dt>
<dd class="method-description">
<p>
証明書を検証します。
</p>
<p>
<a href="../method/-open-s-s-l=3a=3a-x509=3a=3a-store-context/s/new.html">OpenSSL::X509::StoreContext.new</a> で設定した証明書を検証します。
検証に成功した場合は true を、失敗した場合は false を返します。
</p>
<p>
検証の詳細な情報は
</p>
<ul>
<li><a href="../method/-open-s-s-l=3a=3a-x509=3a=3a-store-context/i/error.html">OpenSSL::X509::StoreContext#error</a></li>
<li><a href="../method/-open-s-s-l=3a=3a-x509=3a=3a-store-context/i/error_string.html">OpenSSL::X509::StoreContext#error_string</a></li>
<li><a href="../method/-open-s-s-l=3a=3a-x509=3a=3a-store-context/i/chain.html">OpenSSL::X509::StoreContext#chain</a></li>
<li><a href="../method/-open-s-s-l=3a=3a-x509=3a=3a-store-context/i/current_crl.html">OpenSSL::X509::StoreContext#current_crl</a></li>
</ul>
</dd>


</dl>



<div id="footer">
  <a rel="license" href="https://creativecommons.org/licenses/by/3.0/">
    <img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/3.0/88x31.png" />
  </a>
</div>
</body>
</html>
