<!DOCTYPE html>
<html lang="ja-JP">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Language" content="ja-JP">
  <link rel="stylesheet" type="text/css" href="../style.css">
  <link rel="icon" type="image/png" href="../rurema.png">
  <title>class Socket::AncillaryData (Ruby 1.9.2)</title>
</head>
<body>

<p>
<a href="../doc/index.html">Ruby 1.9.2 リファレンスマニュアル</a>
&gt; <a href="../library/index.html">ライブラリ一覧</a>
&gt; <a href="../library/socket.html">socketライブラリ</a>
&gt; Socket::AncillaryDataクラス
</p>


<h1>class Socket::AncillaryData</h1>
<p>


クラスの継承リスト: Socket::AncillaryData

      &lt; <a href="../class/-object.html">Object</a>
      

      &lt; <a href="../class/-kernel.html">Kernel</a>
      

      &lt; <a href="../class/-basic-object.html">BasicObject</a>
      







</p>

<h2>要約</h2>
<p>
<a href="../method/-basic-socket/i/sendmsg.html">BasicSocket#sendmsg</a> や <a href="../method/-basic-socket/i/recvmsg.html">BasicSocket#recvmsg</a>
で用いる ancillary data (補助データ、制御情報)
を表すクラスです。
</p>
<p>
<a href="../method/-socket=3a=3a-ancillary-data/i/family.html">Socket::AncillaryData#family</a>(socket family),
<a href="../method/-socket=3a=3a-ancillary-data/i/level.html">Socket::AncillaryData#level</a>(cmsg level),
<a href="../method/-socket=3a=3a-ancillary-data/i/type.html">Socket::AncillaryData#type</a>(cmsg type),
<a href="../method/-socket=3a=3a-ancillary-data/i/data.html">Socket::AncillaryData#data</a>(cmsg data),
といった要素を持ちます。
</p>



<h2>目次</h2>
<dl>

<dt>特異メソッド</dt>
<dd>

<a href="#S_INT">int</a>

<a href="#S_IP_PKTINFO">ip_pktinfo</a>

<a href="#S_IPV6_PKTINFO">ipv6_pktinfo</a>

<a href="#S_NEW">new</a>

<a href="#S_UNIX_RIGHTS">unix_rights</a>

</dd>

<dt>インスタンスメソッド</dt>
<dd>

<a href="#I_CMSG_IS--3F">cmsg_is?</a>

<a href="#I_DATA">data</a>

<a href="#I_FAMILY">family</a>

<a href="#I_INT">int</a>

<a href="#I_IP_PKTINFO">ip_pktinfo</a>

<a href="#I_IPV6_PKTINFO">ipv6_pktinfo</a>

<a href="#I_IPV6_PKTINFO_ADDR">ipv6_pktinfo_addr</a>

<a href="#I_IPV6_PKTINFO_IFINDEX">ipv6_pktinfo_ifindex</a>

<a href="#I_LEVEL">level</a>

<a href="#I_TIMESTAMP">timestamp</a>

<a href="#I_TYPE">type</a>

<a href="#I_UNIX_RIGHTS">unix_rights</a>

</dd>

</dl>


<h2>特異メソッド</h2>
<dl>

<dt class="method-heading" id="S_INT"><code>int(family, cmsg_level, cmsg_type, integer) -&gt; Socket::AncillaryData</code><span class="permalink">[<a href="../method/-socket=3a=3a-ancillary-data/s/int.html">permalink</a>][<a href="http://docs.ruby-lang.org/en/1.9.2/Socket/AncillaryData.html#method-c-int">rdoc</a>]</span></dt>
<dd class="method-description">
<p>
データとして整数を保持する
Socket::AncillaryData オブジェクトを生成します。
</p>
<p>
整数データのサイズおよびエンディアンは実行するホストによって異なります。
</p>
<pre>
p Socket::AncillaryData.int(:UNIX, :SOCKET, :RIGHTS, STDERR.fileno)
#=&gt; #&lt;Socket::AncillaryData: UNIX SOCKET RIGHTS 2&gt;
</pre>
<dl>
<dt class='method-param'>[PARAM] family:</dt>
<dd>
ソケットファミリー
</dd>
<dt class='method-param'>[PARAM] cmsg_level:</dt>
<dd>
プロトコル
</dd>
<dt class='method-param'>[PARAM] cmsg_type:</dt>
<dd>
補助データの種類
</dd>
<dt class='method-param'>[PARAM] integer:</dt>
<dd>
データ内容
</dd>
</dl>
<p>
[SEE_ALSO] <a href="../method/-socket=3a=3a-ancillary-data/s/new.html">Socket::AncillaryData.new</a>
</p>
</dd>


<dt class="method-heading" id="S_IP_PKTINFO"><code>ip_pktinfo(addr, ifindex, spec_dst=addr) -&gt; Socket::AncillaryData</code><span class="permalink">[<a href="../method/-socket=3a=3a-ancillary-data/s/ip_pktinfo.html">permalink</a>][<a href="http://docs.ruby-lang.org/en/1.9.2/Socket/AncillaryData.html#method-c-ip_pktinfo">rdoc</a>]</span></dt>
<dd class="method-description">
<p>
type が IP_PKTINFO である AncillaryData を生成します。
</p>
<p>
IP_PKTINFO は非標準的拡張であり、システムによっては使えない場合があります。
</p>
<pre>
addr = Addrinfo.ip(&quot;127.0.0.1&quot;)
ifindex = 0
spec_dst = Addrinfo.ip(&quot;127.0.0.1&quot;)
p Socket::AncillaryData.ip_pktinfo(addr, ifindex, spec_dst)
#=&gt; #&lt;Socket::AncillaryData: INET IP PKTINFO 127.0.0.1 ifindex:0 spec_dst:127.0.0.1&gt;
</pre>
<dl>
<dt class='method-param'>[PARAM] addr:</dt>
<dd>
アドレス(文字列もしくは <a href="../class/-addrinfo.html">Addrinfo</a>)
</dd>
<dt class='method-param'>[PARAM] ifindex:</dt>
<dd>
インターフェースのインデックス(整数)
</dd>
<dt class='method-param'>[PARAM] spec_dst:</dt>
<dd>
パケットのローカルアドレス(文字列もしくは <a href="../class/-addrinfo.html">Addrinfo</a>)
</dd>
</dl>
<p>
[SEE_ALSO] <a href="../method/-socket=3a=3a-ancillary-data/i/ip_pktinfo.html">Socket::AncillaryData#ip_pktinfo</a>,
     <a href="../method/-socket=3a=3a-constants/c/-i-p_-p-k-t-i-n-f-o.html">Socket::Constants::IP_PKTINFO</a>
</p>
</dd>


<dt class="method-heading" id="S_IPV6_PKTINFO"><code>ipv6_pktinfo(addr, ifindex) -&gt; Socket::AncillaryData</code><span class="permalink">[<a href="../method/-socket=3a=3a-ancillary-data/s/ipv6_pktinfo.html">permalink</a>][<a href="http://docs.ruby-lang.org/en/1.9.2/Socket/AncillaryData.html#method-c-ipv6_pktinfo">rdoc</a>]</span></dt>
<dd class="method-description">
<p>
type が IPV6_PKTINFO である AncillaryData を生成します。
</p>
<p>
IPV6_PKTINFO は <a class="external" href="http://www.ietf.org/rfc/rfc3542.txt">[RFC3542]</a> で定義されています。
</p>
<pre>
addr = Addrinfo.ip(&quot;::1&quot;)
ifindex = 0
p Socket::AncillaryData.ipv6_pktinfo(addr, ifindex)
#=&gt; #&lt;Socket::AncillaryData: INET6 IPV6 PKTINFO ::1 ifindex:0&gt;
</pre>
<dl>
<dt class='method-param'>[PARAM] addr:</dt>
<dd>
アドレス(文字列もしくは <a href="../class/-addrinfo.html">Addrinfo</a>)
</dd>
<dt class='method-param'>[PARAM] ifindex:</dt>
<dd>
インターフェースのインデックス(整数)
</dd>
</dl>
<p>
[SEE_ALSO] <a href="../method/-socket=3a=3a-ancillary-data/i/ipv6_pktinfo.html">Socket::AncillaryData#ipv6_pktinfo</a>,
     <a href="../method/-socket=3a=3a-constants/c/-i-p-v6_-p-k-t-i-n-f-o.html">Socket::Constants::IPV6_PKTINFO</a>
</p>
</dd>


<dt class="method-heading" id="S_NEW"><code>new(family, cmsg_level, cmsg_type, cmsg_data) -&gt; Socket::AncillaryData</code><span class="permalink">[<a href="../method/-socket=3a=3a-ancillary-data/s/new.html">permalink</a>][<a href="http://docs.ruby-lang.org/en/1.9.2/Socket/AncillaryData.html#method-c-new">rdoc</a>]</span></dt>
<dd class="method-description">
<p>
新たな Socket::AncillaryData オブジェクトを生成します。
</p>
<p>
family はソケットファミリーを指定します。
整数、文字列、シンボルを渡します。
</p>
<ul>
<li>Socket::AF_INET, &quot;AF_INET&quot;, &quot;INET&quot;, :AF_INET, :INET</li>
<li>Socket::AF_UNIX, &quot;AF_UNIX&quot;, &quot;UNIX&quot;, :AF_UNIX, :UNIX</li>
<li>など</li>
</ul>
<p>
cmsg_level にはメッセージの元となるプロトコルを指定します。
整数、文字列、シンボルを渡します。
</p>
<ul>
<li>Socket::SOL_SOCKET, &quot;SOL_SOCKET&quot;, &quot;SOCKET&quot;, :SOL_SOCKET and :SOCKET</li>
<li>Socket::IPPROTO_IP, &quot;IP&quot; and :IP</li>
<li>Socket::IPPROTO_IPV6, &quot;IPV6&quot; and :IPV6</li>
<li>Socket::IPPROTO_TCP, &quot;TCP&quot; and :TCP</li>
<li>など</li>
</ul>
<p>
cmsg_type は補助データの種類を指定します。
cmsg_level で指定したプロトコルによってこの部分の解釈は異なります。
整数、文字列、シンボルを渡します。
</p>
<ul>
<li>Socket::SCM_RIGHTS, &quot;SCM_RIGHTS&quot;, &quot;RIGHTS&quot;, :SCM_RIGHTS, :RIGHTS for SOL_SOCKET</li>
<li>Socket::IP_RECVTTL, &quot;RECVTTL&quot; and :RECVTTL for IPPROTO_IP</li>
<li>Socket::IPV6_PKTINFO, &quot;PKTINFO&quot; and :PKTINFO for IPPROTO_IPV6</li>
<li>など</li>
</ul>
<p>
cmsg_data には補助データの内容となる文字列を渡します
</p>
<pre>
p Socket::AncillaryData.new(:INET, :TCP, :NODELAY, &quot;&quot;)
#=&gt; #&lt;Socket::AncillaryData: INET TCP NODELAY &quot;&quot;&gt;

p Socket::AncillaryData.new(:INET6, :IPV6, :PKTINFO, &quot;&quot;)
#=&gt; #&lt;Socket::AncillaryData: INET6 IPV6 PKTINFO &quot;&quot;&gt;
</pre>
<dl>
<dt class='method-param'>[PARAM] family:</dt>
<dd>
ソケットファミリー
</dd>
<dt class='method-param'>[PARAM] cmsg_level:</dt>
<dd>
プロトコル
</dd>
<dt class='method-param'>[PARAM] cmsg_type:</dt>
<dd>
補助データの種類
</dd>
<dt class='method-param'>[PARAM] cmsg_data:</dt>
<dd>
データ内容
</dd>
</dl>
</dd>


<dt class="method-heading" id="S_UNIX_RIGHTS"><code>unix_rights(*ios) -&gt; Socket::AncillaryData</code><span class="permalink">[<a href="../method/-socket=3a=3a-ancillary-data/s/unix_rights.html">permalink</a>][<a href="http://docs.ruby-lang.org/en/1.9.2/Socket/AncillaryData.html#method-c-unix_rights">rdoc</a>]</span></dt>
<dd class="method-description">
<p>
ios で指定したファイルのファイルデスクリプタを
データとして持つ family=AF_UNIX, level=SOL_SOCKET, type=SCM_RIGHTS
という Socket::AncillaryData オブジェクトを生成して返します。
</p>
<pre>
p Socket::AncillaryData.unix_rights(STDERR)
#=&gt; #&lt;Socket::AncillaryData: UNIX SOCKET RIGHTS 2&gt;
</pre>
<dl>
<dt class='method-param'>[PARAM] ios:</dt>
<dd>
IO オブジェクトの配列
</dd>
</dl>
<p>
[SEE_ALSO] <a href="../method/-socket=3a=3a-ancillary-data/i/unix_rights.html">Socket::AncillaryData#unix_rights</a>,
     <a href="../method/-socket=3a=3a-constants/c/-s-c-m_-r-i-g-h-t-s.html">Socket::Constants::SCM_RIGHTS</a>
</p>
</dd>


</dl>

<h2>インスタンスメソッド</h2>
<dl>

<dt class="method-heading" id="I_CMSG_IS--3F"><code>cmsg_is?(level, type) -&gt; bool</code><span class="permalink">[<a href="../method/-socket=3a=3a-ancillary-data/i/cmsg_is=3f.html">permalink</a>][<a href="http://docs.ruby-lang.org/en/1.9.2/Socket/AncillaryData.html#method-i-cmsg_is-3F">rdoc</a>]</span></dt>
<dd class="method-description">
<p>
自身の level と type が引数のものと一致している場合に真を返します。
</p>
<pre>
ancdata = Socket::AncillaryData.new(:INET6, :IPV6, :PKTINFO, &quot;&quot;)
ancdata.cmsg_is?(Socket::IPPROTO_IPV6, Socket::IPV6_PKTINFO) #=&gt; true
ancdata.cmsg_is?(:IPV6, :PKTINFO)       #=&gt; true
ancdata.cmsg_is?(:IP, :PKTINFO)         #=&gt; false
ancdata.cmsg_is?(:SOCKET, :RIGHTS)      #=&gt; false
</pre>
<dl>
<dt class='method-param'>[PARAM] level:</dt>
<dd>
一致を確認する cmsg_level (文字列、シンボル、整数)
</dd>
<dt class='method-param'>[PARAM] type:</dt>
<dd>
一致を確認する cmsg_type (文字列、シンボル、整数)
</dd>
</dl>
<p>
[SEE_ALSO] <a href="../method/-socket=3a=3a-ancillary-data/i/level.html">Socket::AncillaryData#level</a>, <a href="../method/-socket=3a=3a-ancillary-data/i/type.html">Socket::AncillaryData#type</a>
</p>
</dd>


<dt class="method-heading" id="I_DATA"><code>data -&gt; String</code><span class="permalink">[<a href="../method/-socket=3a=3a-ancillary-data/i/data.html">permalink</a>][<a href="http://docs.ruby-lang.org/en/1.9.2/Socket/AncillaryData.html#method-i-data">rdoc</a>]</span></dt>
<dd class="method-description">
<p>
自身が保持している cmsg data (データ) を返します。
</p>
<pre>
p Socket::AncillaryData.new(:INET6, :IPV6, :PKTINFO, &quot;&quot;).type
#=&gt; &quot;&quot;
</pre>
<p>
[SEE_ALSO] <a href="../method/-socket=3a=3a-ancillary-data/s/new.html">Socket::AncillaryData.new</a>
</p>
</dd>


<dt class="method-heading" id="I_FAMILY"><code>family -&gt; Integer</code><span class="permalink">[<a href="../method/-socket=3a=3a-ancillary-data/i/family.html">permalink</a>][<a href="http://docs.ruby-lang.org/en/1.9.2/Socket/AncillaryData.html#method-i-family">rdoc</a>]</span></dt>
<dd class="method-description">
<p>
自身が保持している socket family を返します。
</p>
<pre>
p Socket::AncillaryData.new(:INET6, :IPV6, :PKTINFO, &quot;&quot;).family
#=&gt; 10
</pre>
<p>
[SEE_ALSO] <a href="../method/-socket=3a=3a-ancillary-data/s/new.html">Socket::AncillaryData.new</a>
</p>
</dd>


<dt class="method-heading" id="I_INT"><code>int -&gt; Integer</code><span class="permalink">[<a href="../method/-socket=3a=3a-ancillary-data/i/int.html">permalink</a>][<a href="http://docs.ruby-lang.org/en/1.9.2/Socket/AncillaryData.html#method-i-int">rdoc</a>]</span></dt>
<dd class="method-description">
<p>
自身が保持している cmsg data (データ) を整数の形で返します。
</p>
<p>
整数データのサイズおよびエンディアンは実行するホストによって異なります。
</p>
<pre>
ancdata = Socket::AncillaryData.int(:UNIX, :SOCKET, :RIGHTS, STDERR.fileno)
p ancdata.int #=&gt; 2
</pre>
<dl>
<dt>[EXCEPTION] TypeError:</dt>
<dd>
cmgs data のサイズが int のバイト数と異なる場合に発生します
</dd>
</dl>
<p>
[SEE_ALSO] <a href="../method/-socket=3a=3a-ancillary-data/s/new.html">Socket::AncillaryData.new</a> <a href="../method/-socket=3a=3a-ancillary-data/s/int.html">Socket::AncillaryData.int</a>
</p>
</dd>


<dt class="method-heading" id="I_IP_PKTINFO"><code>ip_pktinfo -&gt; [Addrinfo, Integer, Addrinfo]</code><span class="permalink">[<a href="../method/-socket=3a=3a-ancillary-data/i/ip_pktinfo.html">permalink</a>][<a href="http://docs.ruby-lang.org/en/1.9.2/Socket/AncillaryData.html#method-i-ip_pktinfo">rdoc</a>]</span></dt>
<dd class="method-description">
<p>
自身の type が IP_PKTINFO である場合、保持しているデータ
(アドレス、インターフェースのインデックス、ローカルアドレス)
を3要素の配列で返します。
</p>
<p>
IP_PKTINFO は非標準的拡張であり、システムによっては使えない場合があります。
</p>
<pre>
addr = Addrinfo.ip(&quot;127.0.0.1&quot;)
ifindex = 0
spec_dest = Addrinfo.ip(&quot;127.0.0.1&quot;)
ancdata = Socket::AncillaryData.ip_pktinfo(addr, ifindex, spec_dest)
p ancdata.ip_pktinfo
#=&gt; [#&lt;Addrinfo: 127.0.0.1&gt;, 0, #&lt;Addrinfo: 127.0.0.1&gt;]
</pre>
<dl>
<dt>[EXCEPTION] TypeError:</dt>
<dd>
level, type が IPPROTO_IP, IP_PKTINFO でない場合に
発生します。
</dd>
</dl>
<p>
[SEE_ALSO] <a href="../method/-socket=3a=3a-ancillary-data/s/ip_pktinfo.html">Socket::AncillaryData.ip_pktinfo</a>,
     <a href="../method/-socket=3a=3a-constants/c/-i-p_-p-k-t-i-n-f-o.html">Socket::Constants::IP_PKTINFO</a>
</p>
</dd>


<dt class="method-heading" id="I_IPV6_PKTINFO"><code>ipv6_pktinfo -&gt; [Addrinfo, Integer]</code><span class="permalink">[<a href="../method/-socket=3a=3a-ancillary-data/i/ipv6_pktinfo.html">permalink</a>][<a href="http://docs.ruby-lang.org/en/1.9.2/Socket/AncillaryData.html#method-i-ipv6_pktinfo">rdoc</a>]</span></dt>
<dd class="method-description">
<p>
自身の type が IPV6_PKTINFO である場合、保持しているデータ
(アドレス、インターフェースのインデックス)
を2要素の配列で返します。
</p>
<p>
IPV6_PKTINFO については <a class="external" href="http://www.ietf.org/rfc/rfc3542.txt">[RFC3542]</a> を参照してください。
</p>
<pre>
addr = Addrinfo.ip(&quot;::1&quot;)
ifindex = 0
ancdata = Socket::AncillaryData.ipv6_pktinfo(addr, ifindex)
p ancdata.ipv6_pktinfo #=&gt; [#&lt;Addrinfo: ::1&gt;, 0]
</pre>
<p>
[SEE_ALSO] <a href="../method/-socket=3a=3a-ancillary-data/s/ipv6_pktinfo.html">Socket::AncillaryData.ipv6_pktinfo</a>, 
     <a href="../method/-socket=3a=3a-ancillary-data/i/ipv6_pktinfo_addr.html">Socket::AncillaryData#ipv6_pktinfo_addr</a>, 
     <a href="../method/-socket=3a=3a-ancillary-data/i/ipv6_pktinfo_ifindex.html">Socket::AncillaryData#ipv6_pktinfo_ifindex</a>,
     <a href="../method/-socket=3a=3a-constants/c/-i-p-v6_-p-k-t-i-n-f-o.html">Socket::Constants::IPV6_PKTINFO</a>
</p>
</dd>


<dt class="method-heading" id="I_IPV6_PKTINFO_ADDR"><code>ipv6_pktinfo_addr -&gt; Addrinfo</code><span class="permalink">[<a href="../method/-socket=3a=3a-ancillary-data/i/ipv6_pktinfo_addr.html">permalink</a>][<a href="http://docs.ruby-lang.org/en/1.9.2/Socket/AncillaryData.html#method-i-ipv6_pktinfo_addr">rdoc</a>]</span></dt>
<dd class="method-description">
<p>
自身の type が IPV6_PKTINFO である場合、保持しているデータ
(アドレス、インターフェースのインデックス)
のアドレスを返します。
</p>
<pre>
addr = Addrinfo.ip(&quot;::1&quot;)
ifindex = 0
ancdata = Socket::AncillaryData.ipv6_pktinfo(addr, ifindex)
p ancdata.ipv6_pktinfo_addr #=&gt; #&lt;Addrinfo: ::1&gt;
</pre>
<p>
[SEE_ALSO] <a href="../method/-socket=3a=3a-ancillary-data/s/ipv6_pktinfo.html">Socket::AncillaryData.ipv6_pktinfo</a>, 
     <a href="../method/-socket=3a=3a-ancillary-data/i/ipv6_pktinfo.html">Socket::AncillaryData#ipv6_pktinfo</a>, 
     <a href="../method/-socket=3a=3a-ancillary-data/i/ipv6_pktinfo_ifindex.html">Socket::AncillaryData#ipv6_pktinfo_ifindex</a>,
     <a href="../method/-socket=3a=3a-constants/c/-i-p-v6_-p-k-t-i-n-f-o.html">Socket::Constants::IPV6_PKTINFO</a>
</p>
</dd>


<dt class="method-heading" id="I_IPV6_PKTINFO_IFINDEX"><code>ipv6_pktinfo_ifindex -&gt; Integer</code><span class="permalink">[<a href="../method/-socket=3a=3a-ancillary-data/i/ipv6_pktinfo_ifindex.html">permalink</a>][<a href="http://docs.ruby-lang.org/en/1.9.2/Socket/AncillaryData.html#method-i-ipv6_pktinfo_ifindex">rdoc</a>]</span></dt>
<dd class="method-description">
<p>
自身の type が IPV6_PKTINFO である場合、保持しているデータ
(アドレス、インターフェースのインデックス)
のインデックスを返します。
</p>
<pre>
addr = Addrinfo.ip(&quot;::1&quot;)
ifindex = 0
ancdata = Socket::AncillaryData.ipv6_pktinfo(addr, ifindex)
p ancdata.ipv6_pktinfo_ifindex #=&gt; 0
</pre>
<p>
[SEE_ALSO] <a href="../method/-socket=3a=3a-ancillary-data/s/ipv6_pktinfo.html">Socket::AncillaryData.ipv6_pktinfo</a>, 
     <a href="../method/-socket=3a=3a-ancillary-data/i/ipv6_pktinfo.html">Socket::AncillaryData#ipv6_pktinfo</a>, 
     <a href="../method/-socket=3a=3a-ancillary-data/i/ipv6_pktinfo_addr.html">Socket::AncillaryData#ipv6_pktinfo_addr</a>,
     <a href="../method/-socket=3a=3a-constants/c/-i-p-v6_-p-k-t-i-n-f-o.html">Socket::Constants::IPV6_PKTINFO</a>
</p>
</dd>


<dt class="method-heading" id="I_LEVEL"><code>level -&gt; Integer</code><span class="permalink">[<a href="../method/-socket=3a=3a-ancillary-data/i/level.html">permalink</a>][<a href="http://docs.ruby-lang.org/en/1.9.2/Socket/AncillaryData.html#method-i-level">rdoc</a>]</span></dt>
<dd class="method-description">
<p>
自身が保持している cmsg level (元プロトコル) を返します。
</p>
<pre>
p Socket::AncillaryData.new(:INET6, :IPV6, :PKTINFO, &quot;&quot;).level
#=&gt; 41
</pre>
<p>
[SEE_ALSO] <a href="../method/-socket=3a=3a-ancillary-data/s/new.html">Socket::AncillaryData.new</a>
</p>
</dd>


<dt class="method-heading" id="I_TIMESTAMP"><code>timestamp -&gt; Time</code><span class="permalink">[<a href="../method/-socket=3a=3a-ancillary-data/i/timestamp.html">permalink</a>][<a href="http://docs.ruby-lang.org/en/1.9.2/Socket/AncillaryData.html#method-i-timestamp">rdoc</a>]</span></dt>
<dd class="method-description">
<p>
タイムスタンプ制御メッセージに含まれる時刻を <a href="../class/-time.html">Time</a> オブジェクト
で返します。
</p>
<p>
&quot;タイムスタンプ制御メッセージ&quot; は以下のいずれかです。
</p>
<ul>
<li>SOL_SOCKET/SCM_TIMESTAMP (micro second) GNU/Linux, FreeBSD, NetBSD, OpenBSD, Solaris, MacOS X</li>
<li>SOL_SOCKET/SCM_TIMESTAMPNS (nano second) GNU/Linux</li>
<li>SOL_SOCKET/SCM_BINTIME (2**(-64) second) FreeBSD</li>
</ul>
<pre>
Addrinfo.udp(&quot;127.0.0.1&quot;, 0).bind {|s1|
  Addrinfo.udp(&quot;127.0.0.1&quot;, 0).bind {|s2|
    s1.setsockopt(:SOCKET, :TIMESTAMP, true)
    s2.send &quot;a&quot;, 0, s1.local_address
    ctl = s1.recvmsg.last
    p ctl
    #=&gt; #&lt;Socket::AncillaryData: INET SOCKET TIMESTAMP 2009-02-24 17:35:46.775581&gt;
    t = ctl.timestamp
    p t      #=&gt; 2009-02-24 17:35:46 +0900
    p t.usec #=&gt; 775581
    p t.nsec #=&gt; 775581000
  }
}
</pre>
<p>
[SEE_ALSO] <a href="../method/-socket=3a=3a-constants/c/-s-c-m_-t-i-m-e-s-t-a-m-p.html">Socket::Constants::SCM_TIMESTAMP</a>,
     <a href="../method/-socket=3a=3a-constants/c/-s-c-m_-t-i-m-e-s-t-a-m-p-n-s.html">Socket::Constants::SCM_TIMESTAMPNS</a>,
     <a href="../method/-socket=3a=3a-constants/c/-s-c-m_-b-i-n-t-i-m-e.html">Socket::Constants::SCM_BINTIME</a>,
     <a href="../method/-socket=3a=3a-constants/c/-s-o_-t-i-m-e-s-t-a-m-p.html">Socket::Constants::SO_TIMESTAMP</a>,
     <a href="../method/-socket=3a=3a-constants/c/-s-o_-t-i-m-e-s-t-a-m-p-n-s.html">Socket::Constants::SO_TIMESTAMPNS</a>,
     <a href="../method/-socket=3a=3a-constants/c/-s-o_-b-i-n-t-i-m-e.html">Socket::Constants::SO_BINTIME</a>
</p>
</dd>


<dt class="method-heading" id="I_TYPE"><code>type -&gt; Integer</code><span class="permalink">[<a href="../method/-socket=3a=3a-ancillary-data/i/type.html">permalink</a>][<a href="http://docs.ruby-lang.org/en/1.9.2/Socket/AncillaryData.html#method-i-type">rdoc</a>]</span></dt>
<dd class="method-description">
<p>
自身が保持している cmsg type (種類) を返します。
</p>
<pre>
p Socket::AncillaryData.new(:INET6, :IPV6, :PKTINFO, &quot;&quot;).type
#=&gt; 2
</pre>
<p>
[SEE_ALSO] <a href="../method/-socket=3a=3a-ancillary-data/s/new.html">Socket::AncillaryData.new</a>
</p>
</dd>


<dt class="method-heading" id="I_UNIX_RIGHTS"><code>unix_rights -&gt; [IO] | nil</code><span class="permalink">[<a href="../method/-socket=3a=3a-ancillary-data/i/unix_rights.html">permalink</a>][<a href="http://docs.ruby-lang.org/en/1.9.2/Socket/AncillaryData.html#method-i-unix_rights">rdoc</a>]</span></dt>
<dd class="method-description">
<p>
Unix domain socket の SCM_RIGHTS 制御メッセージに含まれる
ファイルディスクリプタを IO オブジェクトの配列として返します。
</p>
<p>
得られる IO オブジェクトか <a href="../class/-i-o.html">IO</a> か <a href="../class/-socket.html">Socket</a> です。
</p>
<p>
この配列は <a href="../class/-socket=3a=3a-ancillary-data.html">Socket::AncillaryData</a> が初期化されたときに
作られます。例えば <a href="../method/-basic-socket/i/recvmsg.html">BasicSocket#recvmsg</a> を :scm_rights =&gt; true
</p>
<pre>
オプションを付けて呼びだし、
</pre>
<p>
SCM_RIGHTS な 制御メッセージを受け取ったときに配列が作られます。
適切なオプションを指定しなかった場合は配列は生成されず、
このメソッドは nil を返します。
</p>
<pre>
# recvmsg needs :scm_rights=&gt;true for unix_rights
s1, s2 = UNIXSocket.pair
p s1                                         #=&gt; #&lt;UNIXSocket:fd 3&gt;
s1.sendmsg &quot;stdin and a socket&quot;, 0, nil, Socket::AncillaryData.unix_rights(STDIN, s1)
_, _, _, ctl = s2.recvmsg(:scm_rights=&gt;true)
p ctl
#=&gt; #&lt;Socket::AncillaryData: UNIX SOCKET RIGHTS 6 7&gt;
p ctl.unix_rights                            #=&gt; [#&lt;IO:fd 6&gt;, #&lt;Socket:fd 7&gt;]
p File.identical?(STDIN, ctl.unix_rights[0]) #=&gt; true
p File.identical?(s1, ctl.unix_rights[1])    #=&gt; true

# If :scm_rights=&gt;true is not given, unix_rights returns nil
s1, s2 = UNIXSocket.pair
s1.sendmsg &quot;stdin and a socket&quot;, 0, nil, Socket::AncillaryData.unix_rights(STDIN, s1)
_, _, _, ctl = s2.recvmsg
p ctl #=&gt; #&lt;Socket::AncillaryData: UNIX SOCKET RIGHTS 6 7&gt;
p ctl.unix_rights #=&gt; nil
</pre>
<dl>
<dt>[EXCEPTION] TypeError:</dt>
<dd>
family/level/type が AF_UNIX/SOL_SOCKET/SCM_RIGHTS でない場合
に発生します。
</dd>
</dl>
<p>
[SEE_ALSO] <a href="../method/-socket=3a=3a-constants/c/-s-c-m_-r-i-g-h-t-s.html">Socket::Constants::SCM_RIGHTS</a>
</p>
</dd>


</dl>



<div id="footer">
  <a rel="license" href="http://creativecommons.org/licenses/by/3.0/">
    <img alt="Creative Commons License" style="border-width:0" src="http://i.creativecommons.org/l/by/3.0/88x31.png" />
  </a>
</div>
</body>
</html>
