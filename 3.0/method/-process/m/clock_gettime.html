<!DOCTYPE html>
<html lang="ja-JP">
<head>

<meta name="robots" content="noindex">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="../../../style.css">
<link rel="stylesheet" href="../../../syntax-highlight.css">
<link rel="icon" type="image/png" href="../../../rurema.png">

<title>Process.#clock_gettime (Ruby 3.0.4 リファレンスマニュアル)</title>
<meta name="description" content="POSIX の clock_gettime() 関数の時間を返します。">
<script src="../../../script.js"></script>
</head>
<body>


<header>
  <nav>
    <ol class="inline-breadcrumb-list">
      <li>
        <a href="../../../doc/index.html">Ruby 3.0.4 リファレンスマニュアル</a>
      </li>
      <li>
        <a href="../../../library/index.html">ライブラリ一覧</a>
      </li>
      <li>
        <a href="../../../library/_builtin.html">組み込みライブラリ</a>
      </li>
      <li>
        <a href="../../../class/-process.html">Processモジュール</a>
      </li>
      <li>
        clock_gettime 
      </li>
    </ol>
  </nav>

<h1>module function Process.#clock_gettime</h1>
</header>

<main>
<dl class="methodlist">

<dt class="method-heading" id="M_CLOCK_GETTIME"><code>clock_gettime(clock_id, unit=:float_second) -&gt; Float | Integer</code><span class="permalink">[<a href="../../../method/-process/m/clock_gettime.html">permalink</a>][<a href="https://docs.ruby-lang.org/en/3.0.4/Process.html#method-c-clock_gettime">rdoc</a>]</span></dt>
<dd class="method-description">
<p>
POSIX の clock_gettime() 関数の時間を返します。
</p>
<p>
例:
</p>
<pre>
p Process.clock_gettime(Process::CLOCK_MONOTONIC) #=&gt; 896053.968060096
</pre>
<dl>
<dt class='method-param'>[PARAM] clock_id:</dt>
<dd>
クロックの種類を以下の定数のいずれかで指定します。サポートされている定数は OS やバージョンに依存します。
</dd>
</dl>
<dl>
<dt><a href="../../../method/-process/c/-c-l-o-c-k_-r-e-a-l-t-i-m-e.html">Process::CLOCK_REALTIME</a></dt>
<dd>
<p>
SUSv2 to 4, Linux 2.5.63, FreeBSD 3.0, NetBSD 2.0, OpenBSD 2.1, macOS 10.12
</p>
</dd>
<dt><a href="../../../method/-process/c/-c-l-o-c-k_-m-o-n-o-t-o-n-i-c.html">Process::CLOCK_MONOTONIC</a></dt>
<dd>
<p>
SUSv3 to 4, Linux 2.5.63, FreeBSD 3.0, NetBSD 2.0, OpenBSD 3.4, macOS 10.12
</p>
</dd>
<dt><a href="../../../method/-process/c/-c-l-o-c-k_-p-r-o-c-e-s-s_-c-p-u-t-i-m-e_-i-d.html">Process::CLOCK_PROCESS_CPUTIME_ID</a></dt>
<dd>
<p>
SUSv3 to 4, Linux 2.5.63, OpenBSD 5.4, macOS 10.12
</p>
</dd>
<dt><a href="../../../method/-process/c/-c-l-o-c-k_-t-h-r-e-a-d_-c-p-u-t-i-m-e_-i-d.html">Process::CLOCK_THREAD_CPUTIME_ID</a></dt>
<dd>
<p>
SUSv3 to 4, Linux 2.5.63, FreeBSD 7.1, OpenBSD 5.4, macOS 10.12
</p>
</dd>
<dt><a href="../../../method/-process/c/-c-l-o-c-k_-v-i-r-t-u-a-l.html">Process::CLOCK_VIRTUAL</a></dt>
<dd>
<p>
FreeBSD 3.0, OpenBSD 2.1
</p>
</dd>
<dt><a href="../../../method/-process/c/-c-l-o-c-k_-p-r-o-f.html">Process::CLOCK_PROF</a></dt>
<dd>
<p>
FreeBSD 3.0, OpenBSD 2.1
</p>
</dd>
<dt><a href="../../../method/-process/c/-c-l-o-c-k_-r-e-a-l-t-i-m-e_-f-a-s-t.html">Process::CLOCK_REALTIME_FAST</a></dt>
<dd>
<p>
FreeBSD 8.1
</p>
</dd>
<dt><a href="../../../method/-process/c/-c-l-o-c-k_-r-e-a-l-t-i-m-e_-p-r-e-c-i-s-e.html">Process::CLOCK_REALTIME_PRECISE</a></dt>
<dd>
<p>
FreeBSD 8.1
</p>
</dd>
<dt><a href="../../../method/-process/c/-c-l-o-c-k_-r-e-a-l-t-i-m-e_-c-o-a-r-s-e.html">Process::CLOCK_REALTIME_COARSE</a></dt>
<dd>
<p>
Linux 2.6.32
</p>
</dd>
<dt><a href="../../../method/-process/c/-c-l-o-c-k_-r-e-a-l-t-i-m-e_-a-l-a-r-m.html">Process::CLOCK_REALTIME_ALARM</a></dt>
<dd>
<p>
Linux 3.0
</p>
</dd>
<dt><a href="../../../method/-process/c/-c-l-o-c-k_-m-o-n-o-t-o-n-i-c_-f-a-s-t.html">Process::CLOCK_MONOTONIC_FAST</a></dt>
<dd>
<p>
FreeBSD 8.1
</p>
</dd>
<dt><a href="../../../method/-process/c/-c-l-o-c-k_-m-o-n-o-t-o-n-i-c_-p-r-e-c-i-s-e.html">Process::CLOCK_MONOTONIC_PRECISE</a></dt>
<dd>
<p>
FreeBSD 8.1
</p>
</dd>
<dt><a href="../../../method/-process/c/-c-l-o-c-k_-m-o-n-o-t-o-n-i-c_-c-o-a-r-s-e.html">Process::CLOCK_MONOTONIC_COARSE</a></dt>
<dd>
<p>
Linux 2.6.32
</p>
</dd>
<dt><a href="../../../method/-process/c/-c-l-o-c-k_-m-o-n-o-t-o-n-i-c_-r-a-w.html">Process::CLOCK_MONOTONIC_RAW</a></dt>
<dd>
<p>
Linux 2.6.28, macOS 10.12
</p>
</dd>
<dt><a href="../../../method/-process/c/-c-l-o-c-k_-m-o-n-o-t-o-n-i-c_-r-a-w_-a-p-p-r-o-x.html">Process::CLOCK_MONOTONIC_RAW_APPROX</a></dt>
<dd>
<p>
macOS 10.12
</p>
</dd>
<dt><a href="../../../method/-process/c/-c-l-o-c-k_-b-o-o-t-t-i-m-e.html">Process::CLOCK_BOOTTIME</a></dt>
<dd>
<p>
Linux 2.6.39
</p>
</dd>
<dt><a href="../../../method/-process/c/-c-l-o-c-k_-b-o-o-t-t-i-m-e_-a-l-a-r-m.html">Process::CLOCK_BOOTTIME_ALARM</a></dt>
<dd>
<p>
Linux 3.0
</p>
</dd>
<dt><a href="../../../method/-process/c/-c-l-o-c-k_-u-p-t-i-m-e.html">Process::CLOCK_UPTIME</a></dt>
<dd>
<p>
FreeBSD 7.0, OpenBSD 5.5
</p>
</dd>
<dt><a href="../../../method/-process/c/-c-l-o-c-k_-u-p-t-i-m-e_-f-a-s-t.html">Process::CLOCK_UPTIME_FAST</a></dt>
<dd>
<p>
FreeBSD 8.1
</p>
</dd>
<dt><a href="../../../method/-process/c/-c-l-o-c-k_-u-p-t-i-m-e_-r-a-w.html">Process::CLOCK_UPTIME_RAW</a></dt>
<dd>
<p>
macOS 10.12
</p>
</dd>
<dt><a href="../../../method/-process/c/-c-l-o-c-k_-u-p-t-i-m-e_-r-a-w_-a-p-p-r-o-x.html">Process::CLOCK_UPTIME_RAW_APPROX</a></dt>
<dd>
<p>
macOS 10.12
</p>
</dd>
<dt><a href="../../../method/-process/c/-c-l-o-c-k_-u-p-t-i-m-e_-p-r-e-c-i-s-e.html">Process::CLOCK_UPTIME_PRECISE</a></dt>
<dd>
<p>
FreeBSD 8.1
</p>
</dd>
<dt><a href="../../../method/-process/c/-c-l-o-c-k_-s-e-c-o-n-d.html">Process::CLOCK_SECOND</a></dt>
<dd>
<p>
FreeBSD 8.1
</p>
</dd>
</dl>
<p>
SUS は Single Unix Specification を意味しており、
SUS は POSIX と POSIX の一部で定義されている clock_gettime を含みます。
SUS では CLOCK_REALTIME は必須ですが、CLOCK_MONOTONIC, CLOCK_PROCESS_CPUTIME_ID,
CLOCK_THREAD_CPUTIME_ID は任意です。
</p>
<p>
さらに clock_id はいくつかのシンボルを受け付けます。それらは clock_gettime() をエミュレーションします。
</p>
<p>
たとえば、<a href="../../../method/-process/c/-c-l-o-c-k_-r-e-a-l-t-i-m-e.html">Process::CLOCK_REALTIME</a> は clock_gettime() がない場合は :GETTIMEOFDAY_BASED_CLOCK_REALTIME と定義されています。
</p>
<p>
CLOCK_REALTIME のエミュレーション:
</p>
<dl>
<dt>:GETTIMEOFDAY_BASED_CLOCK_REALTIME</dt>
<dd>
<p>
SUS で定義されている gettimeofday() を使います。 (しかし SUSv4 で obsoleted になっています)
精度は1マイクロ秒です。
</p>
</dd>
<dt>:TIME_BASED_CLOCK_REALTIME</dt>
<dd>
<p>
ISO C で定義されている time() を使います。精度は1秒です。
</p>
</dd>
</dl>
<p>
CLOCK_MONOTONIC のエミュレーション:
</p>
<dl>
<dt>:MACH_ABSOLUTE_TIME_BASED_CLOCK_MONOTONIC</dt>
<dd>
<p>
Darwin で利用可能な mach_absolute_time() を使います。精度は CPU に依存します。
</p>
</dd>
<dt>:TIMES_BASED_CLOCK_MONOTONIC</dt>
<dd>
<p>
POSIX で定義されている times() の結果を使います。
POSIX では「times() は過去のある時点 (例えばシステムの起動時刻) からの経過クロック数 (clock tick) で実際に経過時間を返します」と定義されています。例えば GNU/Linux では jiffies に基づいた値を返し、monotonic (単調増加が保証されていて、巻き戻ったりしない) です。しかし 4.4BSD では gettimeofday() を使い、monotonic ではありません。
(ただし FreeBSD では clock_gettime(CLOCK_MONOTONIC) を代わりに使います。)
精度はクロック数 (clock tick) です。「getconf CLK_TCK」コマンドで1秒あたりのクロック数を表示できます。
(古いシステムでは、1秒あたりのクロック数は HZ マクロで定義されています。)
もし1秒あたりのクロック数が 100 かつ clock_t が32ビット整数型の場合、精度は10ミリ秒で497日以上を表すことはできません。
</p>
</dd>
</dl>
<p>
CLOCK_PROCESS_CPUTIME_ID のエミュレーション:
</p>
<dl>
<dt>:GETRUSAGE_BASED_CLOCK_PROCESS_CPUTIME_ID</dt>
<dd>
<p>
SUS で定義されている getrusage() を使います。
getrusage() を RUSAGE_SELF と一緒に使うと、(子プロセスの時間をのぞいた)
getrusage() を呼び出したプロセスだけの CPU 時間が得られます。ユーザー時間 (ru_utime) とシステム時間 (ru_stime) を足した結果を返します。精度は1マイクロ秒です。
</p>
</dd>
<dt>:TIMES_BASED_CLOCK_PROCESS_CPUTIME_ID</dt>
<dd>
<p>
POSIX で定義されている times() を使います。ユーザー時間 (tms_utime) と システム時間 (tms_stime) を足した結果を返します。
tms_cutime と tms_cstime は子プロセスの時間を含みません。精度はクロック数 (clock tick) です。「getconf CLK_TCK」コマンドで1秒あたりのクロック数を表示できます。
(古いシステムでは、1秒あたりのクロック数は HZ マクロで定義されています。)
もし1秒あたりのクロック数が100なら、精度は10ミリ秒です。
</p>
</dd>
<dt>:CLOCK_BASED_CLOCK_PROCESS_CPUTIME_ID</dt>
<dd>
<p>
ISO C で定義されている clock() を使います。精度は 1/CLOCKS_PER_SEC です。
CLOCKS_PER_SEC は time.h で定義されているC言語のマクロです。
SUS では CLOCKS_PER_SEC は 1000000 と定義されています。ただし、Unix 以外のシステムでは異なる値に定義されているかもしれません。
SUS で定義されているように CLOCKS_PER_SEC が 1000000 なら、精度は1マイクロ秒です。
CLOCKS_PER_SEC が 1000000 かつ clock_t が32ビット整数型の場合、72分以上を表すことはできません。
</p>
</dd>
</dl>
<dl>
<dt class='method-param'>[PARAM] unit:</dt>
<dd>
返値の型を指定します。
</dd>
</dl>
<dl>
<dt>:float_second</dt>
<dd>
<p>
Float の秒 (デフォルト)
</p>
</dd>
<dt>:float_millisecond</dt>
<dd>
<p>
Float のミリ秒
</p>
</dd>
<dt>:float_microsecond</dt>
<dd>
<p>
Float のマイクロ秒
</p>
</dd>
<dt>:second</dt>
<dd>
<p>
Integer の秒
</p>
</dd>
<dt>:millisecond</dt>
<dd>
<p>
Integer のミリ秒
</p>
</dd>
<dt>:microsecond</dt>
<dd>
<p>
Integer のマイクロ秒
</p>
</dd>
<dt>:nanosecond</dt>
<dd>
<p>
Integer のナノ秒
</p>
</dd>
</dl>
<p>
基になる関数 clock_gettime() はナノ秒を返します。
Float オブジェクト (IEEE 754 double) は CLOCK_REALTIME の結果を表すには不十分です。正確なナノ秒が必要なら、unit に :nanosecond を使ってください。
</p>
<p>
返値のオリジン(0)は様々です。例えば、システムの起動時刻、プロセス起動時刻、エポックなどです。
</p>
<p>
CLOCK_REALTIME のオリジンはエポック (1970-01-01 00:00:00 UTC) と定義されています。しかし、システムによってうるう秒をカウントするかどうかが異なります。そのため、結果はシステムによって解釈が異なります。
CLOCK_REALTIME よりも <a href="../../../method/-time/s/now.html">Time.now</a> をおすすめします。
</p>
<dl>
<dt>[EXCEPTION] Errno::EINVAL:</dt>
<dd>
clock_id がサポートされていない場合に発生します。
</dd>
</dl>
<p>
[SEE_ALSO] <a href="../../../method/-time/s/now.html">Time.now</a>
</p>
</dd>


</dl>
</main>

<footer id="footer">
  <a rel="license" href="https://creativecommons.org/licenses/by/3.0/">
    <img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/3.0/88x31.png" />
  </a>

  <a href="https://github.com/rurema/doctree/issues/new" id="feedback-link">フィードバックを送る</a>
  
  <script>if (window.URLSearchParams) { document.getElementById("feedback-link").search = new URLSearchParams({'body': document.location}); }</script>
</footer>
</body>
</html>
